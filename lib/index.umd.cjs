(function(e,_){typeof exports=="object"&&typeof module<"u"?module.exports=_(require("vue"),require("leader-line-vue"),require("filter-obj")):typeof define=="function"&&define.amd?define(["vue","leader-line-vue","filter-obj"],_):(e=typeof globalThis<"u"?globalThis:e||self,e["decomposition-tree"]=_(e.Vue,e["leader-line-vue"],e["filter-obj"]))})(this,function(e,_,T){"use strict";const H={class:"decomposition-tree-header"},j=["data-uid","data-col","data-index"],x=["onClick"],z=["onClick"],I=e.defineComponent({__name:"DecompositionTree",props:{treeData:{default:()=>[]},height:{default:""},itemHeight:{default:46},itemSpacing:{default:16},color:{default:"rgb(224, 227, 235)"},activeColor:{default:"rgb(138, 110, 250)"},bodyStyle:{default:()=>({})}},emits:["onItemClick"],setup(C,{expose:D,emit:L}){const O=L,d=C,c=e.ref([]),u=e.ref(null),h=e.ref([]),$=e.computed(()=>c.value.length+1),S=e.ref([]),k=e.ref(null),p=new Map;e.onMounted(()=>{e.watchEffect(()=>{b();const n=[];let i=[...d.treeData];new Array($.value).fill([]).forEach((s,t)=>{var r;if(n.push([]),i.forEach((l,o)=>{var a;n[t].push({...T.excludeKeys(l,["children"]),_uid:"item-"+t+"-"+o,_col:t,_index:o,_active:((a=c.value)==null?void 0:a[t])===o})}),u.value!==null&&t>=u.value){i=[];return}i=typeof c.value[t]<"u"?[...((r=i==null?void 0:i[c.value[t]])==null?void 0:r.children)||[]]:[]}),h.value=n,e.nextTick(function(){const s=[];h.value.forEach((l,o)=>{let a=0;for(let m=0;m<l.length;m++)a+=d.itemHeight+(m?d.itemSpacing:0);s.push(a)});let t;if(d.height){const l=window.getComputedStyle(k.value);t=k.value.offsetHeight-parseFloat(l.paddingTop)-parseFloat(l.paddingBottom)-parseFloat(l.borderTopWidth)-parseFloat(l.borderBottomWidth)}else t=Math.max(...s);const r=[];h.value.forEach((l,o)=>{let a=s[o];if(!a||a>=t){r.push(0);return}let m=0;if(!o)m=t/2;else{const v=c.value[o-1];for(let g=0;g<=v;g++)m+=d.itemHeight+(g?d.itemSpacing:0);m+=r[o-1]-d.itemHeight/2}let f=0,y=0;m<=t/2?(y=m*2,y>a?f=(y-a)/2:f=0):(y=(t-m)*2,y>a?f=t-y+(y-a)/2:f=t-a),r.push(f)}),S.value=r,e.nextTick(()=>{const l=k.value.getElementsByClassName("decomposition-tree-item");for(let o=0;o<l.length;o++)p.set(l[o].getAttribute("data-uid"),{el:l[o],lineObj:null});h.value.forEach((o,a)=>{if(!a||!o.length)return;const m=h.value[a-1][c.value[a-1]];o.forEach((f,y)=>{const v=_.setLine(p.get(m._uid).el,p.get(f._uid).el,{color:f._active?d.activeColor:d.color,size:.5,endPlug:"disc"});p.set(f._uid,{el:p.get(f._uid).el,lineObj:v})})})})})})});function b(){p.forEach(n=>{n.lineObj&&n.lineObj.remove()}),p.clear()}let E=null;e.onMounted(function(){k.value.addEventListener("scroll",function(){E!==null&&clearTimeout(E),E=setTimeout(()=>{E=null,p.forEach(n=>{n.lineObj&&n.lineObj.position()})},10)})}),e.onUnmounted(()=>{E!==null&&clearTimeout(E),b(),k.value&&k.value.removeEventListener("scroll")});function B(n,i,s){u.value!==i&&(u.value=null),typeof c.value[i]>"u"?c.value.push(s):(c.value[i]=s,c.value.splice(i+1)),O("onItemClick",n)}function w(n,i,s){if(c.value[i]!==s){B(n,i,s);return}u.value=u.value!==i?i:null}return D({selectedItem:c,columnData:h}),(n,i)=>(e.openBlock(),e.createElementBlock("div",{class:"decomposition-tree",style:e.normalizeStyle({height:d.height})},[e.createElementVNode("div",H,[e.renderSlot(n.$slots,"header",{selectedItem:c.value,columnData:h.value})]),e.createElementVNode("div",{class:"decomposition-tree-body",style:e.normalizeStyle(C.bodyStyle),ref_key:"decompositionTreeRef",ref:k},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(h.value,(s,t)=>(e.openBlock(),e.createElementBlock(e.Fragment,{key:t},[s!=null&&s.length?(e.openBlock(),e.createElementBlock("div",{key:0,class:"decomposition-tree-column",style:e.normalizeStyle({paddingTop:`${S.value[t]}px`})},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(s,(r,l)=>(e.openBlock(),e.createElementBlock("div",{key:l,class:e.normalizeClass(["decomposition-tree-item",{active:r._active}]),"data-uid":r._uid,"data-col":t,"data-index":l,style:e.normalizeStyle({height:`${C.itemHeight}px`,marginBottom:`${C.itemSpacing}px`})},[e.createElementVNode("div",{class:"decomposition-tree-item-cnt",style:e.normalizeStyle({borderColor:r._active?d.activeColor:d.color}),onClick:o=>B(r,t,l)},[e.renderSlot(n.$slots,"item",{item:r,col:t,index:l},()=>[e.createTextVNode(e.toDisplayString(r.id),1)])],12,x),e.createElementVNode("div",{class:e.normalizeClass(["decomposition-tree-item-handle",c.value[t]===l&&u.value!==t?"expand":""]),style:e.normalizeStyle({backgroundColor:d.activeColor}),onClick:o=>w(r,t,l)},e.toDisplayString(!r._active||c.value[t]===l&&u.value!==t?"":"+"),15,z)],14,j))),128))],4)):e.createCommentVNode("",!0)],64))),128))],4),e.renderSlot(n.$slots,"default")],4))}});return{install(C){C.component("DecompositionTree",I)}}});
